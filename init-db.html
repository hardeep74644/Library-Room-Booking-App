<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Initialize Database</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f7fa;
        }

        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #2c3e50;
        }

        button {
            padding: 12px 24px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            margin: 10px 5px;
        }

        button:hover {
            background: #2980b9;
        }

        .success {
            background: #28a745;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }

        .error {
            background: #dc3545;
            color: white;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            display: none;
        }

        .info {
            background: #e9ecef;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }

        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Library Room Booking - Database Initialization</h1>

        <div class="info">
            <h3>What this does:</h3>
            <p>This page will initialize your Firestore database with sample rooms. Click the button below to:</p>
            <ul>
                <li>Add 6 study rooms (3 rooms with 2-person capacity, 3 rooms with 4-person capacity)</li>
                <li>Rooms will be distributed across floors 1, 2, and 3</li>
            </ul>
            <p><strong>Note:</strong> This will only add rooms if they don't already exist.</p>
        </div>

        <div id="success" class="success"></div>
        <div id="error" class="error"></div>

        <button onclick="initializeRooms()">Initialize Sample Rooms</button>
        <button onclick="window.location.href='login.html'">Go to Login</button>

        <div class="info" style="margin-top: 30px;">
            <h3>Test Accounts:</h3>
            <p>You can create test accounts using the registration page:</p>
            <pre>
Student Account:
  Email: student@test.com
  Password: student123
  Role: Student

Librarian Account:
  Email: librarian@test.com
  Password: librarian123
  Role: Librarian
            </pre>
            <p><strong>Note:</strong> You need to create these accounts manually via the <a
                    href="register.html">registration page</a>.</p>
        </div>
    </div>

    <script type="module">
        import { db } from './js/firebase-config.js';
        import { collection, addDoc, getDocs, query, where, Timestamp } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js';

        window.initializeRooms = async function () {
            const successDiv = document.getElementById('success');
            const errorDiv = document.getElementById('error');

            successDiv.style.display = 'none';
            errorDiv.style.display = 'none';

            const sampleRooms = [
                {
                    number: 'R101',
                    floor: 1,
                    capacity: 2,
                    schedule: {
                        days: ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'],
                        startTime: '09:00',
                        endTime: '17:00'
                    }
                },
                {
                    number: 'R102',
                    floor: 1,
                    capacity: 4,
                    schedule: {
                        days: ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'],
                        startTime: '08:00',
                        endTime: '18:00'
                    }
                },
                {
                    number: 'R201',
                    floor: 2,
                    capacity: 2,
                    schedule: {
                        days: ['monday', 'wednesday', 'friday'],
                        startTime: '10:00',
                        endTime: '16:00'
                    }
                },
                {
                    number: 'R202',
                    floor: 2,
                    capacity: 4,
                    schedule: {
                        days: ['tuesday', 'thursday', 'saturday'],
                        startTime: '09:00',
                        endTime: '15:00'
                    }
                },
                {
                    number: 'R301',
                    floor: 3,
                    capacity: 2,
                    schedule: {
                        days: ['monday', 'tuesday', 'wednesday', 'thursday', 'friday'],
                        startTime: '11:00',
                        endTime: '19:00'
                    }
                },
                {
                    number: 'R302',
                    floor: 3,
                    capacity: 4,
                    schedule: {
                        days: ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'],
                        startTime: '08:00',
                        endTime: '20:00'
                    }
                }
            ];

            try {
                let addedCount = 0;
                let skippedCount = 0;

                for (const room of sampleRooms) {
                    // Check if room already exists
                    const roomsRef = collection(db, 'rooms');
                    const q = query(roomsRef, where('number', '==', room.number));
                    const snapshot = await getDocs(q);

                    if (snapshot.empty) {
                        // Add room with schedule
                        await addDoc(collection(db, 'rooms'), {
                            number: room.number,
                            floor: room.floor,
                            capacity: room.capacity,
                            schedule: room.schedule,
                            createdAt: Timestamp.now()
                        });
                        addedCount++;
                    } else {
                        skippedCount++;
                    }
                }

                successDiv.textContent = `✅ Database initialized! Added ${addedCount} rooms with schedules. Skipped ${skippedCount} existing rooms.`;
                successDiv.style.display = 'block';
            } catch (error) {
                console.error('Error initializing database:', error);
                errorDiv.textContent = `❌ Error: ${error.message}`;
                errorDiv.style.display = 'block';
            }
        };
    </script>
</body>

</html>